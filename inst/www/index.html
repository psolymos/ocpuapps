<!DOCTYPE html>
<html lang="en">
<head>
<title>Multiple file upload example</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<script src="assets/jquery-1.11.1.min.js"></script>
<script src="assets/opencpu-0.4.js"></script>

<!--
<link href="assets/bootstrap.min.css" rel="stylesheet" media="screen">
<link href="assets/jquery-ui.min.css" rel="stylesheet" media="screen">

<script src="assets/bootstrap.min.js"></script>
<script src="assets/jquery-ui.min.js"></script>
-->

<script>
//ocpu.seturl("//sc-dev.abmi.ca/ocpu/library/ocpuapps/R")

//actual handler
$("#submitbutton1").on("click", function(){

    //arguments
    var myheader1 = $("#header1").val() == "true";
    var myfile1 = $("#csvfile1")[0].files[0];

    if (!myfile) {
        alert("No file selected.");
        return;
    }

    //disable the button during upload
    $("#submitbutton1").attr("disabled", "disabled");

    //perform the request
    var req1 = ocpu.call("read.csv", {
        "file" : myfile1,
        "header" : myheader1
    }, function(session){
        session.getConsole(function(outtxt){
            $("#output").text(outtxt);
        });
    });

    //if R returns an error, alert the error message
    req.fail(function(){
        alert("Server error: " + req.responseText);
    });

    //after request complete, re-enable the button
    req1.always(function(){
        $("#submitbutton1").removeAttr("disabled")
    });
});

//Chaining function calls

//global var
var mysession;

//calls R function: stats::rnorm(n=100, mean=runif(1)):
$("#postbutton").click(function(){
    var rnd = Math.random();
    var req = ocpu.call("rnorm", {n: 100, mean:rnd}, function(session){
        //assign to global var
        mysession = session;

        //read the session properties (just for fun)
        $("#key").text(mysession.getKey());
        $("#location").text(mysession.getLoc());

        //retrieve session console (async)
        mysession.getConsole(function(outtxt){
            $("#output").text(outtxt);
        });

        //enable the other button
        $("#getbutton").removeAttr("disabled");
    }).fail(function(){
        alert("Error: " + req.responseText);
    });
});

$("#getbutton").click(function(){
    //retrieve object (async)
    mysession.getObject(function(data){
        //data is the object returned by the R function
        alert("Array of length " + data.length + ".\nFirst few values:" + data.slice(0,3));
    });
});

</script>

</head>
<body>

<h1>Examples</h1>

<ul>
    <li><a href="example1-stateless.html">Stateless example 1</a></li>
</ul>

<p>Upload 2 files that define rownames and colnames of a matrix
(filled with some numbers). This file then gets sent to an email
address using the sendmaolR package.</p>

<h3>Step 1: upload file with rownames</h3>

<p>
CSV File 1 <input type="file" id="csvfile1">
<br />

Header <select id="header1">
<option>true</option>
<option>false</option>
</select>
<br />

<button id="submitbutton1" type="button">Upload</button>
</p>

<h3>Step 2: upload file with colnames</h3>

<p>
CSV File 2 <input type="file" id="csvfile2">
<br />

Header <select id="header2">
<option>true</option>
<option>false</option>
</select>
<br />

<button id="submitbutton2" type="button">Upload</button>
</p>

<h3>Step 3: give an email address and submit</h3>

<p>
<textarea id="emailinput" rows="1" cols="20"></textarea>
<br />

<button id="submitbutton3" type="button">Submit</button>
</p>

<p>
<pre><code id="output"></code></pre>
</p>

</body>
</html>
